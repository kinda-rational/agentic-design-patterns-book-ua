# Розділ 10: Протокол контексту моделі

Щоб LLM могли ефективно функціонувати як агенти, їхні можливості повинні виходити за межі мультимодальної генерації. Необхідна взаємодія з зовнішнім середовищем, включаючи доступ до актуальних даних, використання зовнішнього програмного забезпечення та виконання конкретних операційних завдань. Протокол контексту моделі (Model Context Protocol, MCP) вирішує цю потребу, надаючи стандартизований інтерфейс для взаємодії LLM із зовнішніми ресурсами. Цей протокол служить ключовим механізмом для забезпечення послідовної та передбачуваної інтеграції.

# Огляд паттерну MCP

Уявіть універсальний адаптер, який дозволяє будь-якій LLM підключатися до будь-якої зовнішньої системи, бази даних або інструменту без необхідності створення індивідуальної інтеграції для кожної з них. По суті, це і є Протокол контексту моделі (MCP). Це відкритий стандарт, призначений для стандартизації взаємодії LLM, таких як Gemini, моделі GPT від OpenAI, Mixtral і Claude, із зовнішніми додатками, джерелами даних та інструментами. Думайте про нього як про універсальний механізм підключення, який спрощує отримання контексту LLM, виконання дій та взаємодію з різними системами.

MCP працює за архітектурою клієнт-сервер. Він визначає, як різні елементи — дані (звані ресурсами), інтерактивні шаблони (які по суті є промптами) та виконавані функції (звані інструментами) — надаються MCP-сервером. Потім вони споживаються MCP-клієнтом, яким може бути додаток-хост LLM або сам AI-агент. Такий стандартизований підхід значно знижує складність інтеграції LLM в різноманітні операційні середовища.

Однак MCP являє собою контракт для "агентного інтерфейсу", і його ефективність багато в чому залежить від дизайну базових API, які він надає. Існує ризик того, що розробники просто загорнуть існуючі застарілі API без модифікації, що може бути неоптимальним для агента. Наприклад, якщо API системи квитків дозволяє отримувати повні деталі квитків лише по одному, агенту, якого попросили підсумувати високопріоритетні квитки, буде повільно та неточно працювати з великими обсягами. Щоб бути справді ефективним, базовий API повинен бути вдосконалений детерміністичними функціями, такими як фільтрація та сортування, щоб допомогти недетерміністичному агенту працювати ефективно. Це підкреслює, що агенти не замінюють магічним чином детерміністичні робочі процеси; їм часто потрібна сильніша детерміністична підтримка для успіху.

Крім того, MCP може загорнути API, вхідні або вихідні дані якого все ще не є природно зрозумілими для агента. API корисний лише в тому випадку, якщо його формат даних дружелюбний до агента — гарантія, яку сам MCP не забезпечує. Наприклад, створення MCP-сервера для сховища документів, яке повертає файли у форматі PDF, в основному марне, якщо споживаючий агент не може розібрати вміст PDF. Кращим підходом було б спочатку створити API, який повертає текстову версію документа, таку як Markdown, яку агент дійсно може прочитати та обробити. Це демонструє, що розробники повинні враховувати не лише з'єднання, а й природу обмінюваних даних для забезпечення істинної сумісності.

# MCP vs. Функція-звернення інструментів (Tool Function Calling)

Протокол контексту моделі (MCP) та виклик функцій інструментів — це різні механізми, які дозволяють LLM взаємодіяти з зовнішніми можливостями (включаючи інструменти) та виконувати дії. Хоча обидва служать для розширення можливостей LLM за межи генерації тексту, вони відрізняються за підходом та рівнем абстракції.

Виклик функцій інструментів можна розглядати як прямий запит від LLM до конкретного, заздалегідь визначеного інструменту або функції. Зауважте, що в цьому контексті ми використовуємо слова "інструмент" та "функція" взаємозамінно. Ця взаємодія характеризується моделлю комунікації один-до-одного, де LLM форматує запит на основі розуміння наміру користувача, що вимагає зовнішньої дії. Код додатку потім виконує цей запит і повертає результат LLM. Цей процес часто є власницьким та варіюється у різних постачальників LLM.

На відміну від цього, Протокол контексту моделі (MCP) працює як стандартизований інтерфейс для LLM для виявлення, взаємодії та використання зовнішніх можливостей. Він функціонує як відкритий протокол, який сприяє взаємодії з широким спектром інструментів та систем, прагнучи створити екосистему, де будь-який сумісний інструмент може бути доступний будь-якій сумісній LLM. Це сприяє взаємопровідності, компонованості та повторному використанню в різних системах та реалізаціях. Приймаючи федеративну модель, ми значно покращуємо взаємопровідність та розкриваємо цінність існуючих активів. Ця стратегія дозволяє нам привести розпорошені та застарілі сервіси в сучасну екосистему, просто загорнувши їх у MCP-сумісний інтерфейс. Ці сервіси продовжують працювати незалежно, але тепер можуть бути скомпоновані в нові додатки та робочі процеси, з їхнім співпрацею, оркестрованою LLM. Це сприяє гнучкості та повторному використанню без необхідності дорогого перепису базових систем.

Ось розбивка фундаментальних відмінностей між MCP та функцією-зверненням інструментів:

| Аспект | Функція-звернення інструментів | Протокол контексту моделі (MCP) |
|---|---|---|
| **Стандартизація** | Власницька та специфічна для постачальника. Формат та реалізація варіюються у постачальників LLM. | Відкритий, стандартизований протокол, що сприяє взаємопровідності між різними LLM та інструментами. |
| **Область застосування** | Прямий механізм для LLM запросити виконання конкретної, заздалегідь визначеної функції. | Ширша структура того, як LLM та зовнішні інструменти виявляють та взаємодіють один з одним. |
| **Архітектура** | Взаємодія один-до-одного між LLM та логікою обробки інструментів додатку. | Архітектура клієнт-сервер, де додатки з поддержкою LLM (клієнти) можуть підключатися та використовувати різні MCP-сервери (інструменти). |
| **Виявлення** | LLM явно повідомляються про те, які інструменти доступні в контексті конкретної розмови. | Забезпечує динамічне виявлення доступних інструментів. MCP-клієнт може запросити сервер, щоб побачити, які можливості він пропонує. |
| **Повторне використання** | Інтеграції інструментів часто тісно пов'язані з конкретним додатком та використовуваною LLM. | Сприяє розробці повторно використовуваних, автономних "MCP-серверів", які можуть бути доступні будь-якому сумісному додатку. |

Думайте про функцію-звернення інструментів як про надання AI конкретного набору спеціально виготовлених інструментів, таких як певний гайковий ключ та викрутка. Це ефективно для майстерні з фіксованим набором завдань. MCP (Протокол контексту моделі), з іншого боку, подібний до створення універсальної, стандартизованої системи розеток. Він не надає інструменти самі по собі, але дозволяє будь-якому сумісному інструменту від будь-якого виробника підключитися та працювати, забезпечуючи динамічну та постійно розширювану майстерню.

Коротко, функція-звернення надає прямий доступ до кількох конкретних функцій, тоді як MCP є стандартизованою комунікаційною структурою, яка дозволяє LLM виявляти та використовувати широкий спектр зовнішніх ресурсів. Для простих додатків достатньо конкретних інструментів; для складних, взаємопов'язаних AI-систем, які повинні адаптуватися, універсальний стандарт, такий як MCP, необхідний.

# Додаткові розглади для MCP

Хоча MCP являє собою потужну структуру, ретельна оцінка вимагає розглянення кількох важливих аспектів, які впливають на його придатність для конкретного варіанту використання. Розглянемо деякі аспекти більш детально:

- **Інструмент vs. Ресурс vs. Промпт**: Важливо розуміти конкретні ролі цих компонентів. Ресурс — це статичні дані (наприклад, PDF-файл, запис бази даних). Інструмент — це виконавча функція, яка виконує дію (наприклад, відправлення електронної пошти, запит до API). Промпт — це шаблон, який спрямовує LLM у тому, як взаємодіяти з ресурсом або інструментом, забезпечуючи структурованість та ефективність взаємодії.

- **Виявляємість**: Ключевою перевагою MCP є те, що MCP-клієнт може динамічно запросити сервер, щоб дізнатися, які інструменти та ресурси він пропонує. Цей механізм виявлення "точно на час" є потужним для агентів, яким потрібно адаптуватися до нових можливостей без повторного розгортання.

- **Безпека**: Надання інструментів та даних через будь-який протокол вимагає надійних заходів безпеки. Реалізація MCP повинна включати аутентифікацію та авторизацію для контролю того, які клієнти можуть отримати доступ до яких серверів та які конкретні дії їм дозволено виконувати.

- **Реалізація**: Хоча MCP є відкритим стандартом, його реалізація може бути складною. Однак постачальники починають спрощувати цей процес. Наприклад, деякі постачальники моделей, такі як Anthropic чи FastMCP, пропонують SDK, які абстрагують більшість шаблонного коду, спрощуючи розробникам створення та підключення MCP-клієнтів та серверів.

- **Обробка помилок**: Критично важлива комплексна стратегія обробки помилок. Протокол повинен визначити, як помилки (наприклад, збій виконання інструменту, недоступний сервер, невірний запит) передаються назад LLM, щоб вона могла зрозуміти збій і потенційно спробувати альтернативний підхід.

- **Локальний vs. віддалений сервер**: MCP-сервери можуть бути розгорнуті локально на тій самій машині, що й агент, або віддалено на іншому сервері. Локальний сервер можна вибрати для швидкості та безпеки з конфіденційними даними, тоді як архітектура віддаленого сервера дозволяє спільний, масштабований доступ до загальних інструментів в організації.

- **На вимогу vs. пакетна обробка**: MCP може підтримувати як інтерактивні сеанси на вимогу, так і крупномасштабну пакетну обробку. Вибір залежить від додатку, від агента в реальному часі для розмови, що потребує негайного доступу до інструментів, до конвеєра аналізу даних, що обробляє записи пакетами.

- **Механізм транспорту**: Протокол також визначає базові шари транспорту для комунікації. Для локальних взаємодій він використовує JSON-RPC через STDIO (стандартний вхід/вихід) для ефективної міжпроцесної комунікації. Для віддалених з'єднань він використовує веб-дружелюбні протоколи, такі як Streamable HTTP та Server-Sent Events (SSE), для забезпечення постійної та ефективної комунікації клієнт-сервер.

Протокол контексту моделі використовує модель клієнт-сервер для стандартизації потоку інформації. Розуміння взаємодії компонентів є ключем до продвинутої поведінки агента MCP:

1. **Велика мовна модель (LLM)**: Основний інтелект. Вона обробляє користувацькі запити, формулює плани та вирішує, коли їй потрібно отримати доступ до зовнішньої інформації або виконати дію.

2. **MCP-клієнт**: Це додаток або обгортка навколо LLM. Він діє як посередник, перекладаючи намір LLM у формальний запит, який відповідає стандарту MCP. Він відповідає за виявлення, підключення та взаємодію з MCP-серверами.

3. **MCP-сервер**: Це шлюз до зовнішнього світу. Він надає набір інструментів, ресурсів та промптів будь-якому авторизованому MCP-клієнту. Кожний сервер звичайно відповідає за конкретну область, таку як підключення до внутрішньої корпоративної бази даних, служби електронної пошти або публічного API.

4. **Додатковий сторонній сервіс**: Це представляє фактичний зовнішній інструмент, додаток або джерело даних, яким керує та надає MCP-сервер. Це кінцева точка, яка виконує запитану дію, таку як запит до власницької бази даних, взаємодія з SaaS-платформою або виклик публічного API погоди.

Взаємодія відбувається наступним чином:

1. **Виявлення**: MCP-клієнт від імені LLM запитує MCP-сервер, щоб дізнатися, які можливості він пропонує. Сервер відповідає маніфестом, що перелічує його доступні інструменти (наприклад, send_email), ресурси (наприклад, customer_database) та промпти.

2. **Формулювання запиту**: LLM визначає, що їй потрібно використати один з виявлених інструментів. Наприклад, вона вирішує відправити електронний лист. Вона формулює запит, вказуючи інструмент для використання (send_email) та необхідні параметри (одержувач, тема, тіло).

3. **Комунікація клієнта**: MCP-клієнт бере сформульований LLM запит і відправляє його як стандартизований виклик відповідному MCP-серверу.

4. **Виконання сервера**: MCP-сервер отримує запит. Він аутентифікує клієнта, перевіряє запит, а потім виконує вказану дію, взаємодіючи з базовим програмним забезпеченням (наприклад, викликаючи функцію send() API електронної пошти).

5. **Відповідь та оновлення контексту**: Після виконання MCP-сервер відправляє стандартизований відповідь назад MCP-клієнту. Цей відповідь вказує, чи була дія успішною, та включає будь-який відповідний результат (наприклад, ID підтвердження для відправленого листа). Клієнт потім передає цей результат назад LLM, оновлюючи її контекст та дозволяючи їй продовжити наступним кроком її завдання.

# Практичні застосування та варіанти використання

MCP значно розширює можливості AI/LLM, роблячи їх більш універсальними та потужними. Ось дев'ять ключових варіантів використання:

- **Інтеграція з базами даних**: MCP дозволяє LLM та агентам безперешкодно отримувати доступ та взаємодіяти зі структурованими даними в базах даних. Наприклад, використовуючи MCP Toolbox для баз даних, агент може запитувати набори даних Google BigQuery для отримання інформації в реальному часі, генерувати звіти або оновлювати записи, все це керується командами природною мовою.

- **Оркестрація генеративних медіа**: MCP дозволяє агентам інтегруватися з передовими сервісами генеративних медіа. Через MCP Tools для сервісів Genmedia агент може оркеструвати робочі процеси, що включають Google Imagen для генерації зображень, Google Veo для створення відео, Google Chirp 3 HD для реалістичних голосів або Google Lyria для композиції музики, дозволяючи динамічне створення контенту в AI-додатках.

- **Взаємодія із зовнішніми API**: MCP забезпечує стандартизований спосіб для LLM викликати та отримувати відповіді від будь-якого зовнішнього API. Це означає, що агент може отримувати дані про погоду в реальному часі, витягувати ціни акцій, відправляти електронні листи або взаємодіяти з CRM-системами, розширюючи свої можливості далеко за межи базової мовної моделі.

- **Витяг інформації на основі міркування**: Використовуючи сильні навички міркування LLM, MCP сприяє ефективному, залежному від запиту витягу інформації, який перевершує звичайні системи пошуку та витягу. Замість традиційного інструменту пошуку, що повертає весь документ, агент може аналізувати текст та витягувати точну клаузулу, цифру або твердження, яке безпосередньо відповідає на складне питання користувача.

- **Розробка користувальницьких інструментів**: Розробники можуть створювати користувальницькі інструменти та надавати їх через MCP-сервер (наприклад, використовуючи FastMCP). Це дозволяє спеціалізованим внутрішнім функціям або власницьким системам бути доступними для LLM та інших агентів у стандартизованому, легко споживаному форматі без необхідності безпосередньо змінювати LLM.

- **Стандартизована комунікація LLM-до-додатку**: MCP забезпечує послідовний комунікаційний шар між LLM та додатками, з якими вони взаємодіють. Це зменшує накладні витрати на інтеграцію, сприяє взаємопровідності між різними постачальниками LLM та хост-додатками та спрощує розробку складних агентних систем.

- **Оркестрація складних робочих процесів**: Об'єднуючи різні інструменти та джерела даних, надані через MCP, агенти можуть оркеструвати висока складні, багатокрокові робочі процеси. Агент міг би, наприклад, отримати дані про клієнтів із бази даних, генерувати персоналізоване маркетингове зображення, скласти індивідуальний лист, а потім відправити його, все це взаємодіючи з різними MCP-сервісами.

- **Управління пристроями IoT**: MCP може полегшити взаємодію LLM з пристроями Інтернету речей (IoT). Агент міг би використовувати MCP для надсилання команд розумним домашнім приладам, промисловим датчикам або робототехніці, забезпечуючи управління та автоматизацію фізичних систем природною мовою.

- **Автоматизація фінансових послуг**: У фінансових послугах MCP міг би дозволити LLM взаємодіяти з різними джерелами фінансових даних, торговельними платформами або системами відповідності. Агент міг би аналізувати дані ринку, виконувати торги, генерувати персоналізовані фінансові поради або автоматизувати нормативну звітність, все це при дотриманні безпечної та стандартизованої комунікації.

Коротко, Протокол контексту моделі (MCP) дозволяє агентам отримувати доступ до інформації в реальному часі з баз даних, API та веб-ресурсів. Він також дозволяє агентам виконувати дії, такі як відправлення листів, оновлення записів, управління пристроями та виконання складних завдань шляхом інтеграції та обробки даних з різних джерел. Крім того, MCP підтримує інструменти генерування медіа для AI-додатків.

# Практичний приклад коду з ADK

Цей розділ описує, як підключитися до локального MCP-сервера, який надає операції файлової системи, дозволяючи ADK-агенту взаємодіяти з локальною файловою системою.

## Налаштування агента з MCPToolset

Для налаштування агента для взаємодії з файловою системою необхідно створити файл `agent.py` (наприклад, у `./adk_agent_samples/mcp_agent/agent.py`). `MCPToolset` створюється в списку `tools` об'єкту `LlmAgent`. Критично важливо замінити `"/path/to/your/folder"` у списку `args` на абсолютний шлях до директорії в локальній системі, до якої MCP-сервер може отримати доступ. Ця директорія буде коренем для операцій файлової системи, виконуваних агентом.

```python
import os
from google.adk.agents import LlmAgent
from google.adk.tools.mcp_tool.mcp_toolset import MCPToolset, StdioServerParameters

# Створюємо надійний абсолютний шлях до папки з іменем 'mcp_managed_files'
# в тій же директорії, що й цей скрипт агента.
# Це забезпечує роботу агента «з коробки» для демонстрації.
# Для продакшену ви б указали це на більш постійне та безпечне місце.
TARGET_FOLDER_PATH = os.path.join(os.path.dirname(os.path.abspath(__file__)), "mcp_managed_files")

# Переконаємось, що цільова директорія існує до того, як агент в ній нуждається.
os.makedirs(TARGET_FOLDER_PATH, exist_ok=True)

root_agent = LlmAgent(
    model='gemini-2.0-flash',
    name='filesystem_assistant_agent',
    instruction=(
        'Допоможіть користувачу управляти їхніми файлами. Ви можете перелічувати файли, читати файли та записувати файли. '
        f'Ви працюєте в наступній директорії: {TARGET_FOLDER_PATH}'
    ),
    tools=[
        MCPToolset(
            connection_params=StdioServerParameters(
                command='npx',
                args=[
                    "-y",  # Аргумент для npx для автопідтвердження встановлення
                    "@modelcontextprotocol/server-filesystem",
                    # Це ПОВИНЕН бути абсолютний шлях до папки.
                    TARGET_FOLDER_PATH,
                ],
            ),
            # Опціонально: Ви можете відфільтрувати, які інструменти від MCP-сервера надаються.
            # Наприклад, щоб дозволити тільки читання:
            # tool_filter=['list_directory', 'read_file']
        )
    ],
)
```

`npx` (Node Package Execute), що входить до складу npm (Node Package Manager) версій 5.2.0 і пізніше, це утиліта, яка дозволяє прямий запуск Node.js пакетів з реєстру npm. Це усуває необхідність глобальної встановлення. По суті, `npx` служить як виконавець npm-пакетів, і він зазвичай використовується для запуску багатьох публічних MCP-серверів, які розповсюджуються як Node.js пакети.

Створення файлу **init**.py необхідне для забезпечення того, щоб файл agent.py був розпізнаний як частина виявляємого Python-пакета для Agent Development Kit (ADK). Цей файл повинен знаходитися в тій же директорії, що й agent.py.

```python
# ./adk_agent_samples/mcp_agent/__init__.py
from . import agent
```

Звичайно, інші підтримані команди доступні для використання. Наприклад, підключення до python3 може бути досягнуто наступним чином:

```python
connection_params = StdioConnectionParams(
    server_params={
        "command": "python3",
        "args": ["./agent/mcp_server.py"],
        "env": {
            "SERVICE_ACCOUNT_PATH": SERVICE_ACCOUNT_PATH,
            "DRIVE_FOLDER_ID": DRIVE_FOLDER_ID
        }
    }
)
```

UVX, в контексті Python, відноситься до інструменту командного рядка, який використовує uv для запуску команд в тимчасовому, ізольованому Python-середовищі. По суті, він дозволяє вам запускати Python-інструменти та пакети без необхідності встановлювати їх глобально або в середовищі вашого проекту. Ви можете запустити його через MCP-сервер.

```python
connection_params = StdioConnectionParams(
    server_params={
        "command": "uvx",
        "args": ["mcp-google-sheets@latest"],
        "env": {
            "SERVICE_ACCOUNT_PATH": SERVICE_ACCOUNT_PATH,
            "DRIVE_FOLDER_ID": DRIVE_FOLDER_ID
        }
    }
)
```

Після створення MCP-сервера наступним кроком є підключення до нього.

## Підключення MCP-сервера з ADK Web

Для початку виконайте 'adk web'. Перейдіть до батьківської директорії mcp_agent (наприклад, adk_agent_samples) у вашому терміналі та виконайте:

```bash
cd ./adk_agent_samples # Або ваша еквівалентна батьківська директорія
adk web
```

Після завантаження ADK Web UI у вашому браузері виберіть `filesystem_assistant_agent` з меню агентів. Потім експериментуйте з промптами, такими як:

- "Покажіть мне вміст цієї папки."
- "Прочитайте файл `sample.txt`." (Це передбачає, що `sample.txt` знаходиться в `TARGET_FOLDER_PATH`.)
- "Що в `another_file.md`?"

## Створення MCP-сервера з FastMCP

FastMCP — це високорівневий Python-фреймворк, призначений для спрощення розробки MCP-серверів. Він надає рівень абстракції, який упрощує складності протоколу, дозволяючи розробникам сосередоточитися на основній логіці.

Бібліотека дозволяє швидко визначити інструменти, ресурси та промпти, використовуючи прості Python-декоратори. Значною перевагою є його автоматична генерація схем, яка інтелектуально інтерпретує підписи Python-функцій, підказки типів та рядки документації для побудови необхідних специфікацій інтерфейсу AI-моделі. Ця автоматизація мінімізує ручне налаштування та зменшує людські помилки.

Поза базовим створенням інструментів, FastMCP спрощує передові архітектурні паттерни, такі як композиція серверів та проксування. Це дозволяє модульну розробку складних, багатокомпонентних систем та безперешкодну інтеграцію існуючих сервісів в AI-доступну структуру. Крім того, FastMCP включає оптимізації для ефективних, розподілених та масштабованих AI-управляємих додатків.

## Налаштування сервера з FastMCP

Для ілюстрації розглянемо базовий інструмент "greet", наданий сервером. ADK-агенти та інші MCP-клієнти можуть взаємодіяти з цим інструментом через HTTP, як тільки він стане активним.

```python
# fastmcp_server.py
# Цей скрипт демонструє, як створити простий MCP-сервер, використовуючи FastMCP.
# Він надає єдиний інструмент, який генерує привіт.

# 1. Переконайтесь, що у вас установлений FastMCP:
# pip install fastmcp
from fastmcp import FastMCP, Client

# Ініціалізуємо FastMCP-сервер.
mcp_server = FastMCP()

# Визначаємо просту функцію інструменту.
# Декоратор `@mcp_server.tool` реєструє цю Python-функцію як MCP-інструмент.
# Рядок документації стає описом інструменту для LLM.
@mcp_server.tool
def greet(name: str) -> str:
    """
    Генерує персоналізований привіт.

    Args:
        name: Ім'я людини для привітання.

    Returns:
        Рядок привітання.
    """
    return f"Привіт, {name}! Приємно познайомитися."

# Або якщо ви хочете запустити його зі скрипту:
if __name__ == "__main__":
    mcp_server.run(
        transport="http",
        host="127.0.0.1",
        port=8000
    )
```

Цей Python-скрипт визначає єдину функцію під назвою greet, яка приймає ім'я людини та повертає персоналізований привіт. Декоратор @tool() над цією функцією автоматично реєструє її як інструмент, який AI або інша програма може використовувати. Рядок документації функції та підказки типів використовуються FastMCP для повідомлення агенту, як працює інструмент, які вхідні дані йому потрібні та що він повертає.

Коли скрипт виконується, він запускає FastMCP-сервер, який слухає запити на localhost:8000. Це робить функцію greet доступною як мережевий сервіс. Агент потім можна налаштувати для підключення до цього сервера та використання інструменту greet для генерування привітань як частини більшої задачі. Сервер працює безперервно, поки не буде вручну зупинений.

## Споживання FastMCP-сервера з ADK-агентом

ADK-агент можна налаштувати як MCP-клієнт для використання працюючого FastMCP-сервера. Це вимагає налаштування HttpServerParameters з мережевою адресою FastMCP-сервера, яка звичайно http://localhost:8000.

Параметр tool_filter може бути включений для обмеження використання інструментів агентом конкретними інструментами, запропонованими сервером, такими як 'greet'. Коли агенту дається запит типу "Поприветствуйте Джона Доу", вбудована LLM агента визначає інструмент 'greet', доступний через MCP, викликає його з аргументом "Джон Доу" та повертає відповідь сервера. Цей процес демонструє інтеграцію користувацьких інструментів, наданих через MCP, з ADK-агентом.

Для встановлення цієї конфігурації потрібен файл агента (наприклад, agent.py, розташований у ./adk_agent_samples/fastmcp_client_agent/). Цей файл створить ADK-агента та використовуватиме HttpServerParameters для встановлення з'єднання з працюючим FastMCP-сервером.

```python
# ./adk_agent_samples/fastmcp_client_agent/agent.py
import os
from google.adk.agents import LlmAgent
from google.adk.tools.mcp_tool.mcp_toolset import MCPToolset, HttpServerParameters

# Визначаємо адресу FastMCP-сервера.
# Переконайтесь, що ваш fastmcp_server.py (визначений раніше) працює на цьому порту.
FASTMCP_SERVER_URL = "http://localhost:8000"

root_agent = LlmAgent(
    model='gemini-2.0-flash',  # Або ваша бажана модель
    name='fastmcp_greeter_agent',
    instruction='Ви дружелюбний помічник, який може привітати людей за іменами. Використовуйте інструмент "greet".',
    tools=[
        MCPToolset(
            connection_params=HttpServerParameters(
                url=FASTMCP_SERVER_URL,
            ),
            # Опціонально: Відфільтруйте, які інструменти від MCP-сервера надаються
            # Для цього прикладу ми очікуємо тільки 'greet'
            tool_filter=['greet']
        )
    ],
)
```

Скрипт визначає агента з іменем fastmcp_greeter_agent, який використовує мовну модель Gemini. Йому дається конкретна інструкція діяти як дружелюбний помічник, метою якого є привітання людей. Критично важливо, що код оснащує цього агента інструментом для виконання його завдання. Він налаштовує MCPToolset для підключення до окремого сервера, що працює на localhost:8000, який, як очікується, є FastMCP-сервером з попереднього прикладу. Агенту конкретно надається доступ до інструменту greet, розташованого на цьому сервері. По суті, цей код налаштовує клієнтську сторону системи, створюючи інтелектуального агента, який розуміє, що його мета — привітати людей, і знає саме, який зовнішній інструмент використовувати для цього.

Створення файлу **init**.py у директорії fastmcp_client_agent необхідне. Це забезпечує розпізнавання агента як виявляємого Python-пакета для ADK.

Для початку відкрийте новий термінал та запустіть `python fastmcp_server.py` для запуску FastMCP-сервера. Потім перейдіть до батьківської директорії `fastmcp_client_agent` (наприклад, `adk_agent_samples`) у вашому терміналі та виконайте `adk web`. Після завантаження ADK Web UI у вашому браузері виберіть `fastmcp_greeter_agent` з меню агентів. Потім ви можете протестувати його, введявши промпт типу "Поприветствуйте Джона Доу." Агент використовуватиме інструмент `greet` на вашому FastMCP-сервері для створення відповіді.

# З першого погляду

**Що:** Щоб функціонувати як ефективні агенти, LLM повинні вийти за межи простої генерації тексту. Їм потрібна здатність взаємодіяти з зовнішнім середовищем для отримання доступу до актуальних даних та використання зовнішнього програмного забезпечення. Без стандартизованого методу комунікації кожна інтеграція між LLM та зовнішнім інструментом або джерелом даних стає індивідуальною, складною та неповторно використовуваною задачею. Такий ad-hoc підхід перешкоджає масштабованості та ускладнює побудову складних, взаємопов'язаних AI-систем.

**Чому:** Протокол контексту моделі (MCP) пропонує стандартизоване рішення, діючи як універсальний інтерфейс між LLM та зовнішніми системами. Він встановлює відкритий, стандартизований протокол, який визначає, як зовнішні можливості виявляються та використовуються. Працюючи за моделлю клієнт-сервер, MCP дозволяє серверам надавати інструменти, ресурси даних та інтерактивні промпти будь-якому сумісному клієнту. Додатки з поддержкою LLM діють як ці клієнти, динамічно виявляючи та взаємодіючи з доступними ресурсами передбачуваним способом. Такий стандартизований підхід сприяє створенню екосистеми взаємопровідних та повторно використовуваних компонентів, значно спрощуючи розробку складних агентних робочих процесів.

**Практичне правило:** Використовуйте Протокол контексту моделі (MCP) при побудові складних, масштабованих або корпоративних агентних систем, які повинні взаємодіяти з різноманітним та розвивним набором зовнішніх інструментів, джерел даних та API. Він ідеальний, коли взаємопровідність між різними LLM та інструментами є пріоритетом, та коли агентам потрібна здатність динамічно виявляти нові можливості без повторного розгортання. Для простіших додатків з фіксованим та обмеженим набором заздалегідь визначених функцій може бути достатньо прямого виклику функцій інструментів.

**Візуальне резюме**

![][image1]

_Рис.1: Протокол контексту моделі_

# Ключові висновки

Це ключові висновки:

- Протокол контексту моделі (MCP) — це відкритий стандарт, який сприяє стандартизованій комунікації між LLM та зовнішніми додатками, джерелами даних та інструментами.

- Він використовує архітектуру клієнт-сервер, визначаючи методи надання та споживання ресурсів, промптів та інструментів.

- Agent Development Kit (ADK) підтримує як використання існуючих MCP-серверів, так і надання ADK-інструментів через MCP-сервер.

- FastMCP спрощує розробку та управління MCP-серверами, особливо для надання інструментів, реалізованих на Python.

- MCP Tools для сервісів Genmedia дозволяє агентам інтегруватися з можливостями генеративних медіа Google Cloud (Imagen, Veo, Chirp 3 HD, Lyria).

- MCP дозволяє LLM та агентам взаємодіяти з реальними системами, отримувати доступ до динамічної інформації та виконувати дії за межами генерації тексту.

# Висновок

Протокол контексту моделі (MCP) — це відкритий стандарт, який сприяє комунікації між Великими мовними моделями (LLM) та зовнішніми системами. Він використовує архітектуру клієнт-сервер, дозволяючи LLM отримувати доступ до ресурсів, використовувати промпти та виконувати дії через стандартизовані інструменти. MCP дозволяє LLM взаємодіяти з базами даних, керувати робочими процесами генеративних медіа, контролювати пристрої IoT та автоматизувати фінансові послуги. Практичні приклади демонструють налаштування агентів для взаємодії з MCP-серверами, включаючи сервери файлової системи та сервери, побудовані з FastMCP, ілюструючи його інтеграцію з Agent Development Kit (ADK). MCP є ключовим компонентом для розробки інтерактивних AI-агентів, які виходять за межи базових мовних можливостей.

# Посилання

1. [Документація Протоколу контексту моделі (MCP)](https://google.github.io/adk-docs/mcp/)

2. [Документація FastMCP](https://github.com/jlowin/fastmcp)

3. [MCP Tools для сервісів Genmedia](https://google.github.io/adk-docs/mcp/#mcp-servers-for-google-cloud-genmedia)

4. [Документація MCP Toolbox для баз даних](https://google.github.io/adk-docs/mcp/databases/)

[image1]: ../Assets/chapter-10-image1.png

---

## Навігація

**Назад:** [Розділ 9. Навчання та адаптація](Розділ%209.%20Навчання%20та%20адаптація.md)
**Вперед:** [Розділ 11. Постановка цілей та моніторинг](Розділ%2011.%20Постановка%20цілей%20та%20моніторинг.md)
