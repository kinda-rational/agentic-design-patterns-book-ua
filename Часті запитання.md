### **Часті запитання: Агентні патерни проєктування**

**Що таке "агентний патерн проєктування"?** Агентний патерн проєктування — це багаторазове високорівневе рішення загальної проблеми, з якою стикаються при створенні інтелектуальних автономних систем (агентів). Ці патерни забезпечують структуровану основу для проєктування поведінки агентів, подібно до того, як патерни проєктування програмного забезпечення роблять для традиційного програмування. Вони допомагають розробникам створювати більш надійних, передбачуваних і ефективних AI-агентів.

**Яка основна мета цього посібника?** Посібник спрямований на надання практичного введення в проєктування і створення агентних систем. Він виходить за межі теоретичних обговорень, пропонуючи конкретні архітектурні креслення, які розробники можуть використовувати для створення агентів, здатних до складної, цілеспрямованої поведінки надійним способом.

**Хто є цільовою аудиторією для цього посібника?** Цей посібник написаний для AI-розробників, інженерів-програмістів і архітекторів систем, які створюють застосунки з великими мовними моделями (LLM) та іншими AI-компонентами. Він призначений для тих, хто хоче перейти від простих взаємодій промпт-відповідь до створення складних, автономних агентів.

**4. Які ключові агентні патерни обговорюються?** Основуючись на змісті, посібник охоплює кілька ключових патернів, включаючи:

- **Рефлексія:** Здатність агента критикувати свої власні дії та висновки для покращення продуктивності.
- **Планування:** Процес розбиття складної мети на менші, керовані кроки або завдання.
- **Використання інструментів:** Патерн агента, який використовує зовнішні інструменти (такі як інтерпретатори коду, пошукові системи або інші API) для отримання інформації або виконання дій, які він не може зробити самостійно.
- **Багатоагентна співпраця:** Архітектура для спільної роботи кількох спеціалізованих агентів для вирішення проблеми, часто включаючи "лідера" або "оркестратора" агента.
- **Людина в контурі:** Інтеграція людського нагляду і втручання, що дозволяє зворотний зв'язок, корекцію і схвалення дій агента.

**Чому "планування" є важливим патерном?** Планування має вирішальне значення, оскільки воно дозволяє агенту вирішувати складні багатокрокові завдання, які не можуть бути вирішені однією дією. Створюючи план, агент може підтримувати зв'язну стратегію, відстежувати свій прогрес і обробляти помилки або несподівані перешкоди структурованим чином. Це запобігає "застряванню" агента або відхиленню від кінцевої мети користувача.

**У чому різниця між "інструментом" і "навичкою" для агента?** Хоча терміни часто використовуються взаємозамінно, "інструмент" зазвичай стосується зовнішнього ресурсу, до якого агент може звернутися (наприклад, API погоди, калькулятор). "Навичка" — це більш інтегрована здатність, яку агент вивчив, часто комбінуючи використання інструментів із внутрішнім міркуванням для виконання конкретної функції (наприклад, навичка "бронювання рейсу" може включати використання календарних і авіаційних API).

**Як патерн "Рефлексія" покращує продуктивність агента?** Рефлексія діє як форма самокорекції. Після генерації відповіді або завершення завдання агент може бути промптований для рецензування своєї роботи, перевірки помилок, оцінки якості проти визначених критеріїв або розгляду альтернативних підходів. Цей ітеративний процес покращення допомагає агенту створювати більш точні, релевантні і якісні результати.

**У чому основна ідея патерна Рефлексії?** Патерн Рефлексії дає агенту здатність відступити і критикувати свою власну роботу. Замість створення фінального висновку за один раз агент генерує чернетку і потім "рефлектує" над нею, виявляючи недоліки, відсутню інформацію або області для покращення. Цей процес самокорекції є ключем до підвищення якості і точності його відповідей.

**Чому проста "ланцюг промптів" недостатня для якісного висновку?** Проста ланцюг промптів (де висновок одного промпта стає вводом для наступного) часто занадто базова. Модель може просто перефразувати свій попередній висновок без справжнього покращення. Істинний патерн Рефлексії вимагає більш структурованої критики, промптуючи агента для аналізу своєї роботи проти конкретних стандартів, перевірки логічних помилок або верифікації фактів.

**Які два основних типи рефлексії згадуються в цьому розділі?** Розділ обговорює дві первинні форми рефлексії:

- **Рефлексія "Перевір свою роботу":** Це базова форма, де агента просто просять рецензувати і виправити свій попередній висновок. Це хороша відправна точка для виявлення простих помилок.
- **Рефлексія "Внутрішній критик":** Це більш просунута форма, де використовується окремий агент-"критик" (або виділений промпт) для оцінки висновку "робочого" агента. Цей критик може отримати конкретні критерії для пошуку, приводячи до більш суворих і цілеспрямованих покращень.

**Як рефлексія допомагає в зменшенні "галюцинацій"?** Промптуючи агента рецензувати свою роботу, особливо порівнюючи його твердження проти відомого джерела або перевіряючи свої власні кроки міркування, патерн Рефлексії може значно зменшити ймовірність галюцинацій (вигадування фактів). Агент змушений бути більш заземленим у наданому контексті і менш схильним генерувати непідтримувану інформацію.

**Чи може патерн Рефлексії застосовуватися більше ніж один раз?** Так, рефлексія може бути ітеративним процесом. Агент може бути змушений рефлексувати над своєю роботою кілька разів, з кожним циклом покращуючи висновок далі. Це особливо корисно для складних завдань, де перша або друга спроба можуть все ще містити тонкі помилки або можуть бути суттєво покращені.

**Що таке паттерн Планування в контексті AI-агентів?** Паттерн Планування включає включення агента розбивати складну високорівневу мету в послідовність менших, виконуваних кроків. Замість того, щоб намагатися вирішити велику проблему відразу, агент спочатку створює "план", а потім виконує кожен крок у плані, що є набагато більш надійним підходом.

**Чому планування необхідне для складних завдань?** LLM можуть боротися з завданнями, які вимагають множинних кроків або залежностей. Без плану агент може втратити слід загальної мети, пропустити вирішальні кроки або не впоратися з висновком одного кроку як вводом для наступного. План забезпечує чітку дорожню карту, гарантуючи, що всі вимоги оригінального запиту виконані в логічному порядку.

**Який загальний спосіб реалізації паттерна Планування?** Загальна реалізація — мати агента спочатку генерувати список кроків у структурованому форматі (як JSON масив або пронумерований список). Система може потім ітерувати через цей список, виконуючи кожен крок один за одним і передаючи результат назад агенту для інформування наступного дії.

**Як агент обробляє помилки або зміни під час виконання?** Надійний патерн планування дозволяє динамічно коригувати дії. Якщо крок зазнає невдачі або ситуація змінюється, агент може бути промптований "перепланувати" з поточного стану. Він може аналізувати помилку, модифікувати залишкові кроки або навіть додавати нові для подолання перешкоди.

**Чи бачить користувач план?** Це вибір дизайну. У багатьох випадках показ плану користувачу спочатку для схвалення є відмінною практикою. Це узгоджується з патерном "Людина в контурі", даючи користувачу прозорість і контроль над запропонованими діями агента перед їх виконанням.

**Що включає патерн "Використання інструментів"?** Патерн Використання інструментів дозволяє агенту розширювати свої можливості, взаємодіючи з зовнішнім програмним забезпеченням або API. Оскільки знання LLM статичні і він не може виконувати дії в реальному світі самостійно, інструменти дають йому доступ до актуальної інформації (наприклад, Google Search), пропрієтарних даних (наприклад, бази даних компанії) або можливість виконувати дії (наприклад, надіслати email, забронювати зустріч).

**Як агент вирішує, який інструмент використовувати?** Агенту зазвичай надається список доступних інструментів разом з описами того, що кожен інструмент робить і які параметри він вимагає. Коли стикається із запитом, який він не може обробити своїми внутрішніми знаннями, здатність міркування агента дозволяє йому вибрати найбільш підходящий інструмент зі списку для виконання завдання.

**Що таке фреймворк "ReAct" (Розмірковувати і Діяти), згаданий у цьому контексті?** ReAct — це популярний фреймворк, який інтегрує розмірковування і дію. Агент слідує циклу **Думка** (розмірковування про те, що йому потрібно зробити), **Дія** (вирішення, який інструмент використовувати і з якими входами), і **Спостереження** (бачення результату від інструмента). Цей цикл триває, поки він не збере достатньо інформації для виконання запиту користувача.

**Які деякі виклики в реалізації використання інструментів?** Ключові виклики включають:

- **Обробка помилок:** Інструменти можуть зазнавати невдачі, повертати неочікувані дані або тайм-аутитися. Агент повинен бути здатний розпізнавати ці помилки і вирішувати, спробувати знову, використовувати інший інструмент або попросити користувача про допомогу.
- **Безпека:** Надання агенту доступу до інструментів, особливо тих, які виконують дії, має наслідки безпеки. Критично мати захисні механізми, дозволи і часто людське схвалення для чутливих операцій.
- **Промптинг:** Агент повинен бути ефективно промптований для генерації правильно відформатованих викликів інструментів (наприклад, правильне ім'я функції і параметри).

**Що таке патерн "Людина в контурі" (HITL)?** HITL — це патерн, який інтегрує людський нагляд і взаємодію в робочий процес агента. Замість того щоб бути повністю автономним, агент зупиняється в критичних точках, щоб попросити людську зворотний зв'язок, схвалення, уточнення або напрямок.

**Чому HITL важливий для агентних систем?** Це критично з кількох причин:

- **Безпека і контроль:** Для високоставкових завдань (наприклад, фінансові транзакції, відправка офіційних комунікацій) HITL забезпечує людську верифікацію запропонованих дій агента перед їх виконанням.
- **Покращення якості:** Люди можуть надати корекції або нюансовану зворотний зв'язок, яку агент може використовувати для покращення своєї продуктивності, особливо в суб'єктивних або неоднозначних завданнях.
- **Побудова довіри:** Користувачі більш схильні довіряти і приймати AI-систему, яку вони можуть направляти і контролювати.

**В яких точках робочого процесу слід включати людину?** Загальні точки для людського втручання включають:

- **Схвалення плану:** Перед виконанням багатокрокового плану.
- **Підтвердження використання інструмента:** Перед використанням інструмента, який має наслідки в реальному світі або коштує грошей.
- **Дозвіл неоднозначності:** Коли агент не впевнений, як продовжити або потребує додаткової інформації від користувача.
- **Фінальний огляд висновку:** Перед доставкою фінального результату кінцевому користувачу або системі.

**Хіба постійне людське втручання не є неефективним?** Це може бути, тому ключ у знаходженні правильного балансу. HITL повинен бути реалізований у критичних контрольних точках, а не для кожного окремого дії. Мета — побудувати спільне партнерство між людиною і агентом, де агент обробляє основну частину роботи, а людина надає стратегічне керівництво.

**Що таке патерн "Багатоагентне співробітництво"?** Цей патерн включає створення системи, що складається з множинних спеціалізованих агентів, які працюють разом для досягнення спільної мети. Замість одного "універсального" агента, який намагається робити все, ви створюєте команду "спеціалізованих" агентів, кожен зі своєю конкретною роллю або експертизою.

**Які переваги багатоагентної системи?**

- **Модульність і спеціалізація:** Кожен агент може бути тонко налаштований і промптований для своєї конкретної задачі (наприклад, агент-"дослідник", агент-"письменник", агент-"код"), приводячи до більш якісних результатів.
- **Зменшена складність:** Розбиття складного робочого процесу на спеціалізовані ролі робить загальну систему легшою для проєктування, налагодження і підтримки.
- **Симульований мозковий штурм:** Різні агенти можуть пропонувати різні перспективи на проблему, приводячи до більш креативних і надійних рішень, подібно до того, як працює людська команда.

**Яка загальна архітектура для багатоагентних систем?** Загальна архітектура включає **Агента-оркестратора** (іноді називаного "менеджером" або "диригентом"). Оркестратор розуміє загальну мету, розбиває її і делегує підзадачі відповідним спеціалізованим агентам. Потім він збирає результати від спеціалістів і синтезує їх у фінальний висновок.

**Як агенти спілкуються один з одним?** Комунікація часто управляється оркестратором. Наприклад, оркестратор може передати висновок агента-"дослідника" агенту-"письменника" як контекст. Загальний "чернетка" або шина повідомлень, де агенти можуть розміщати свої знахідки, є іншим загальним методом комунікації.

**Чому оцінка агента більш складна, ніж оцінка традиційної програми?** Традиційне програмне забезпечення має детерміновані висновки (той же ввід завжди виробляє той же висновок). Агенти, особливо ті, які використовують LLM, недетерміновані, і їх продуктивність може бути суб'єктивною. Оцінка їх вимагає оцінки _якості_ і _релевантності_ їх висновку, а не просто того, технічно чи "правильний" він.

**Які деякі загальні методи для оцінки продуктивності агента?** Посібник пропонує кілька методів:

- **Оцінка на основі результату:** Чи успішно агент досяг фінальної мети? Наприклад, якщо завдання полягало в "забронювати рейс", чи був рейс фактично заброньований правильно? Це найважливіша міра.
- **Оцінка на основі процесу:** Чи був _процес_ агента ефективним і логічним? Чи використовував він правильні інструменти? Чи слідував він розумному плану? Це допомагає налагоджувати, чому агент може зазнати невдачі.
- **Людська оцінка:** Мати людей оцінювати продуктивність агента за шкалою (наприклад, 1-5) на основі критеріїв, таких як корисність, точність і зв'язність. Це критично для користувацьких застосунків.

**Що таке "траєкторія агента"?** Траєкторія агента — це повний лог кроків агента при виконанні завдання. Вона включає всі його думки, дії (виклики інструментів) і спостереження. Аналіз цих траєкторій є ключовою частиною налагодження і розуміння поведінки агента.

**Як можна створити надійні тести для недетермінованої системи?** Хоча ви не можете гарантувати точну формулювання висновку агента, ви можете створити тести, які перевіряють ключові елементи. Наприклад, ви можете написати тест, який верифікує, чи містить фінальний відповідь агента конкретну інформацію або успішно чи він викликав певний інструмент з правильними параметрами. Це часто робиться з використанням мок-інструментів у виділеній тестовій середовищі.

**Чим промптинг агента відрізняється від простого промпта ChatGPT?** Промптинг агента включає створення детального "системного промпта" або конституції, яка діє як його операційні інструкції. Це виходить за межі єдиного користувацького запиту; це визначає роль агента, його доступні інструменти, паттерни, яким він повинен слідувати (як ReAct або Планування), його обмеження і його особистість.

**Які ключові компоненти хорошого системного промпта для агента?** Сильний системний промпт типово включає:

- **Роль і мета:** Чітко визначте, хто агент і яка його первинна мета.
- **Визначення інструментів:** Список доступних інструментів, їх описи і як їх використовувати (наприклад, у специфічному форматі виклику функцій).
- **Обмеження і правила:** Явні інструкції про те, що агент _не повинен_ робити (наприклад, "Не використовуйте інструменти без схвалення", "Не надавайте фінансові поради").
- **Інструкції процесу:** Керівництво по тому, які паттерни використовувати. Наприклад, "Спочатку створіть план. Потім виконайте план покроково."
- **Приклади траєкторій:** Надання кількох прикладів успішних циклів "думка-дія-спостереження" може значно покращити надійність агента.

**Що таке "витік промпта"?** Витік промпта відбувається, коли частини системного промпта (як визначення інструментів або внутрішні інструкції) непередбачено розкриваються у фінальному відповіді агента користувачу. Це може спантеличувати користувача і розкривати лежачі деталі реалізації. Техніки, такі як використання окремих промптів для розмірковування і для генерації фінального відповіді, можуть допомогти запобігти цьому.

**Які деякі майбутні тенденції в агентних системах?** Посібник вказує на майбутнє з:

- **Більш автономними агентами:** Агентами, які вимагають менше людського втручання і можуть навчатися і адаптуватися самостійно.
- **Високоспеціалізованими агентами:** Екосистемою агентів, яких можна наймати або підписувати на конкретні завдання (наприклад, туристичний агент, дослідницький агент).
- **Кращими інструментами і платформами:** Розвитком більш витончених фреймворків і платформ, які полегшують створення, тестування і розгортання надійних багатоагентних систем.

---

## Навігація

**Назад:** [Подяки](Подяки.md)
