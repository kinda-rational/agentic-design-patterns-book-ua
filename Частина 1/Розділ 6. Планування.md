# Розділ 6: Планування

Інтелектуальна поведінка часто включає щось більше, ніж просто реагування на безпосередній вхідний сигнал. Вона вимагає дальновидності, розбиття складних завдань на менші, керовані кроки та розробку стратегії для досягнення бажаного результату. Саме тут вступає в гру паттерн Планування. У своїй суті планування — це здатність агента або системи агентів сформулювати послідовність дій для переходу від початкового стану до цільового стану.

# Огляд паттерну Планування

У контексті ШІ корисно думати про планування агента як про спеціаліста, якому ви делегуєте складну ціль. Коли ви просите його «організувати командний виїзд», ви визначаєте що — ціль та її обмеження — але не як. Основна задача агента полягає в тому, щоб автономно проложити шлях до цієї мети. Він повинен спочатку зрозуміти початковий стан (наприклад, бюджет, кількість учасників, бажані дати) та цільовий стан (успішно забронований виїзд), а потім знайти оптимальну послідовність дій для їх з'єднання. План не відомий заздалегідь; він створюється у відповідь на запит.

Відмінною рисою цього процесу є адаптивність. Початковий план — це лише відправна точка, а не жорсткий сценарій. Справжня сила агента полягає в його здатності враховувати нову інформацію та спрямовувати проект через перешкоди. Наприклад, якщо переважне місце проведення стає недоступним або вибраний кейтеринг повністю зарезервований, здатний агент не просто терпить невдачу. Він адаптується. Він реєструє нове обмеження, переоцінює свої варіанти та формулює новий план, можливо, пропонуючи альтернативні місця проведення або дати.

Однак вкрай важливо визнати компроміс між гнучкістю та передбачуваністю. Динамічне планування — це конкретний інструмент, а не універсальне рішення. Коли розв'язання проблеми вже добре зрозуміле та відтворюване, обмеження агента заздалегідь визначеним, фіксованим робочим процесом більш ефективно. Цей підхід обмежує автономність агента, щоб знизити невизначеність та ризик непередбачуваної поведінки, гарантуючи надійний та послідовний результат. Тому рішення про використання планування агента проти простого агента виконання завдань залежить від одного питання: потрібно ви виявити «як», чи він уже відомий?

# Практичні застосування та випадки використання

Паттерн Планування є основним обчислювальним процесом в автономних системах, що дозволяє агенту синтезувати послідовність дій для досягнення певної мети, особливо в динамічних або складних середовищах. Цей процес перетворює високорівневу мету на структурований план, що складається з дискретних, виконуваних кроків.

У таких областях, як автоматизація процедурних завдань, планування використовується для оркестрації складних робочих процесів. Наприклад, бізнес-процес, такий як адаптація нового працівника, може бути розкладений на спрямовану послідовність підзавдань, таких як створення системних облікових записів, призначення навчальних модулів та координація з різними відділами. Агент генерує план для виконання цих кроків у логічному порядку, викликаючи необхідні інструменти або взаємодіючи з різними системами для керування залежностями.

У робототехніці та автономній навігації планування є фундаментальним для подорожі простором стану. Система, будь то фізичний робот або віртуальна сутність, повинна генерувати шлях або послідовність дій для переходу від початкового стану до цільового стану. Це включає оптимізацію за такими метриками, як час або споживання енергії, при дотриманні екологічних обмежень, таких як уникнення перешкод або дотримання правил дорожного руху.

Цей паттерн також критично важливий для структурованого синтезу інформації. Коли агенту доручено генерувати складний вихід, такий як дослідницький звіт, він може сформулювати план, що включає окремі фази для збору інформації, підсумовування даних, структурування контенту та ітеративного уточнення. Аналогічно, у сценаріях підтримки клієнтів, що включають багатоетапне розв'язання проблем, агент може створити та слідувати систематичному плану для діагностики, реалізації рішення та ескалації.

По суті, паттерн Планування дозволяє агенту вийти за межі простих, реактивних дій до цілеспрямованої поведінки. Він забезпечує логічну структуру, необхідну для розв'язання проблем, що вимагають зв'язної послідовності взаємозалежних операцій.

# Практичний код (CrewAI)

Наступний розділ продемонструє реалізацію паттерну Планування з використанням фреймворку Crew AI. Цей паттерн включає агента, який спочатку формулює багатокроковий план для розв'язання складного запиту, а потім послідовно виконує цей план.

```python
import os
from dotenv import load_dotenv
from crewai import Agent, Task, Crew, Process
from langchain_openai import ChatOpenAI

# Завантажити змінні оточення з файлу .env для безпеки
load_dotenv()

# 1. Явно визначити мовну модель для ясності
llm = ChatOpenAI(model="gpt-4-turbo")

# 2. Визначити чіткого та зосередженого агента
planner_writer_agent = Agent(
    role='Планувальник та письменник статей',
    goal='Спланувати та написати стислий, привабливий резюме на вказану тему.',
    backstory=(
        'Ви — експертний технічний письменник та стратег контенту. '
        'Ваша сила полягає у створенні чіткого, дійсного плану перед написанням, '
        'забезпечуючи, що остаточне резюме є як інформативним, так і легким для розуміння.'
    ),
    verbose=True,
    allow_delegation=False,
    llm=llm  # Призначити конкретну LLM агенту
)

# 3. Визначити завдання з більш структурованим та конкретним очікуваним виходом
topic = "Важливість навчання з підкріпленням у ШІ"
high_level_task = Task(
    description=(
        f"1. Створити план з маркованого списку для резюме на тему: '{topic}'.\n"
        f"2. Написати резюме на основі вашого плану, тримаючи його близько 200 слів."
    ),
    expected_output=(
        "Остаточний звіт, що містить два окремі розділи:\n\n"
        "### План\n"
        "- Список з маркерами, що окреслює основні пункти резюме.\n\n"
        "### Резюме\n"
        "- Стисле та добре структуроване резюме теми."
    ),
    agent=planner_writer_agent,
)

# Створити команду з чітким процесом
crew = Crew(
    agents=[planner_writer_agent],
    tasks=[high_level_task],
    process=Process.sequential,
)

# Виконати завдання
print("## Запуск завдання планування та написання ##")
result = crew.kickoff()
print("\n\n---\n## Результат завдання ##\n---")
print(result)
```

Цей код використовує бібліотеку CrewAI для створення ШІ-агента, який планує та пише резюме на вказану тему. Він починається з імпорту необхідних бібліотек, включаючи Crew.ai та langchain_openai, та завантажує змінні оточення з файлу .env. Мовна модель ChatOpenAI явно визначена для використання з агентом. Створюється агент з іменем planner_writer_agent з конкретною роллю та ціллю: планування та написання стислого резюме. Передумова агента підкреслює його експертизу у плануванні та технічному письмі. Визначається завдання з чітким описом: спочатку створити план, потім написати резюме на тему «Важливість навчання з підкріпленням у ШІ», з визначеним форматом для очікуваного виходу. Команда зібрана з агентом та завданням, налаштованої на їх послідовну обробку. Нарешті, викликається метод crew.kickoff() для виконання визначеного завдання, і результат виводиться на друк.

# Google DeepResearch

Google Gemini DeepResearch (див. Рис.1) — це агентна система, призначена для автономного пошуку та синтезу інформації. Вона функціонує через багатоетапний агентний конвеєр, який динамічно та ітеративно запитує Google Search для систематичного дослідження складних тем. Система спроектована для обробки великого корпусу веб-джерел, оцінки зібраних даних на релевантність та прогалини в знаннях, а також виконання наступних пошуків для їх усунення. Підсумковий результат консолідує перевірену інформацію в структурований, багатосторінковий резюме з цитатами оригінальних джерел.

Розвиваючи цю ідею, робота системи — це не одна-редис запит-відповідь, а керований, довгостроковий процес. Він починається з деконструкції користувацького промпта в багатопунктний дослідницький план (див. Рис. 1), який потім представляється користувачу для перегляду та модифікації. Це дозволяє співпрацювально формувати траєкторію дослідження перед виконанням. Після схвалення плану агентний конвеєр ініціює свій ітеративний цикл пошуку та аналізу. Це включає не просто виконання серії попередньо визначених пошуків; агент динамічно формулює та уточнює свої запити на основі інформації, яку він збирає, активно виявляючи прогалини в знаннях, підтверджуючи точки даних та розв'язуючи розбіжності.

![][image4]
Рис. 1: Агент Google Deep Research генерує план виконання для використання Google Search як інструменту.

Ключовим архітектурним компонентом є здатність системи керувати цим процесом асинхронно. Така конструкція забезпечує стійкість дослідження, яке може включати аналіз сотень джерел, до окремих точок відмови та дозволяє користувачу відключитися та отримати сповіщення після завершення. Система також може інтегрувати користувацькі документи, об'єднуючи інформацію з приватних джерел з веб-дослідженням. Підсумковий результат — це не просто конкатенований список находок, а структурований, багатосторінковий звіт. На етапі синтезу модель виконує критичну оцінку зібраної інформації, визначаючи основні теми та організуючи контент у зв'язне наративу з логічними розділами. Звіт створюється інтерактивним, часто включаючи такі функції, як аудіообзор, діаграми та посилання на оригінальні цитовані джерела, що дозволяє користувачу перевіряти та подальше дослідити. Окрім синтезованих результатів, модель явно повертає повний список джерел, які вона шукала та консультувала (див. Рис.2). Вони представлені як цитати, забезпечуючи повну прозорість та прямий доступ до першоджерел. Весь цей процес перетворює простий запит на всебічний, синтезований корпус знань.

![][image3]
Рис. 2: Приклад виконання плану Deep Research, результатом якого є використання Google Search як інструменту для пошуку різних веб-джерел.

Пом'якшуючи значні часові та ресурсні інвестиції, необхідні для ручного збору та синтезу даних, Gemini DeepResearch надає більш структурований та всебічний метод для виявлення інформації. Цінність системи особливо очевидна в складних, багатогранних дослідницьких завданнях у різних областях.

Наприклад, у конкурентному аналізі агент може бути спрямований на систематичний збір та порівняння даних про ринкові тренди, специфікації продуктів конкурентів, громадську думку з різноманітних онлайн-джерел та маркетингові стратегії. Цей автоматизований процес замінює виснажливе завдання ручного відстеження численних конкурентів, дозволяючи аналітикам зосередитися на стратегічній інтерпретації високого порядку, а не на збиранні даних (див. Рис. 3).

![][image2]
Рис. 3: Остаточний результат, сгенерований агентом Google Deep Research, що аналізує від нашого імені джерела, отримані за допомогою Google Search як інструменту.

Аналогічно, у академічному дослідженні система служить потужним інструментом для проведення масштабних оглядів літератури. Вона може виявляти та підсумовувати основоположні статті, відстежувати розвиток концепцій у численних публікаціях та картографувати новостворені дослідницькі фронти в певній галузі, тим самим прискорюючи початкову та найбільш часовитратну фазу академічного дослідження.

Ефективність цього підходу походить від автоматизації ітеративного циклу пошуку та фільтрування, який є основним вузьким місцем ручного дослідження. Всебічність досягається здатністю системи обробляти більший обсяг та різноманітність інформаційних джерел, ніж звичайно можливо для людини-дослідника в співставних часових рамках. Цей більш широкий охопленням аналізу допомагає зменшити потенціал селективної упередженості та збільшує ймовірність виявлення менш очевидної, але потенційно критичної інформації, що веде до більш надійного та добре обґрунтованого розуміння предмета.

# OpenAI Deep Research API

OpenAI Deep Research API — це спеціалізований інструмент, призначений для автоматизації складних дослідницьких завдань. Він використовує передову агентну модель, яка може независимо міркувати, планувати та синтезувати інформацію з реальних джерел. На відміну від простої моделі запиту-відповіді, він приймає високорівневий запит та автономно розбиває його на підзапитання, виконує веб-пошуки, використовуючи свої вбудовані інструменти, та надає структурований, багатий цитатами підсумковий звіт. API надає прямий програмний доступ до всього цього процесу, використовуючи на момент написання такі моделі, як o3-deep-research-2025-06-26 для високої якості синтезу та швидший o4-mini-deep-research-2025-06-26 для додатків, чутливих до затримок.

Deep Research API корисна, оскільки автоматизує те, що інакше потребувало б годин ручного дослідження, надаючи професійні, засновані на даних звіти, придатні для інформування бізнес-стратегії, інвестиційних рішень або політичних рекомендацій. Його ключові переваги включають:

- **Структурований, цитуємий вихід:** Він виробляє добре організовані звіти із вбудованими цитатами, пов'язаними з метаданими джерел, забезпечуючи перевіряємість тверджень та їх підкріплення даними.
- **Прозорість:** На відміну від абстрагованого процесу в ChatGPT, API розкриває всі проміжні кроки, включаючи міркування агента, конкретні запити веб-пошуку, які він виконав, та будь-який код, який він запустив. Це дозволяє детальну відладку, аналіз та глибше розуміння того, як був побудований остаточний результат.
- **Розширюваність:** Він підтримує Model Context Protocol (MCP), дозволяючи розробникам підключити агента до приватних баз знань та внутрішніх джерел даних, комбінуючи публічне веб-дослідження з пропрієтарною інформацією.

Для використання API ви відправляєте запит до кінцевої точки client.responses.create, вказуючи модель, вхідний промпт та інструменти, які може використовувати агент. Вхід зазвичай включає system_message, який визначає персону агента та бажаний формат виходу, разом з user_query. Ви також повинні включити інструмент web_search_preview та можете дополнительно додати інші, такі як code_interpreter або користувальницькі MCP інструменти (див. Розділ 10) для внутрішніх даних.

```python
from openai import OpenAI

# Ініціалізувати клієнт з вашим API-ключем
client = OpenAI(api_key="YOUR_OPENAI_API_KEY")

# Визначити роль агента та дослідницький вопрос користувача
system_message = """Ви — професійний дослідник, що підготовує структурований, засновану на даних звіт.
Зосередьтеся на інформації, багатій на дані, використовуйте надійні джерела та включайте вбудовані цитати."""

user_query = "Досліджуйте економічний вплив семаглутиду на глобальні системи охорони здоров'я."

# Створити вибір Deep Research API
response = client.responses.create(
    model="o3-deep-research-2025-06-26",
    input=[
        {
            "role": "developer",
            "content": [{"type": "input_text", "text": system_message}]
        },
        {
            "role": "user",
            "content": [{"type": "input_text", "text": user_query}]
        }
    ],
    reasoning={"summary": "auto"},
    tools=[{"type": "web_search_preview"}]
)

# Отримати доступ та надрукувати остаточний звіт з відповіді
final_report = response.output[-1].content[0].text
print(final_report)

# --- ОТРИМАТИ ДОСТУП ДО ВБУДОВАНИХ ЦИТАТ ТА МЕТАДАНИХ ---
print("--- ЦИТАТИ ---")
annotations = response.output[-1].content[0].annotations

if not annotations:
    print("Анотацій не знайдено у звіті.")
else:
    for i, citation in enumerate(annotations):
        # Текстовий проміжок, до якого відноситься цитата
        cited_text = final_report[citation.start_index:citation.end_index]
        print(f"Цитата {i+1}:")
        print(f"  Цитований текст: {cited_text}")
        print(f"  Заголовок: {citation.title}")
        print(f"  URL: {citation.url}")
        print(f"  Місцезнаходження: chars {citation.start_index}–{citation.end_index}")

print("\n" + "="*50 + "\n")

# --- ІНСПЕКТУВАТИ ПРОМІЖНІ КРОКИ ---
print("--- ПРОМІЖНІ КРОКИ ---")

# 1. Кроки міркування: Внутрішні плани та резюме, створені моделлю.
try:
    reasoning_step = next(item for item in response.output if item.type == "reasoning")
    print("\n[Знайдено крок міркування]")
    for summary_part in reasoning_step.summary:
        print(f"  - {summary_part.text}")
except StopIteration:
    print("\nКроків міркування не знайдено.")

# 2. Виклики веб-пошуку: Точні пошукові запити, які виконав агент.
try:
    search_step = next(item for item in response.output if item.type == "web_search_call")
    print("\n[Знайдено виклик веб-пошуку]")
    print(f"  Виконаний запит: '{search_step.action['query']}'")
    print(f"  Статус: {search_step.status}")
except StopIteration:
    print("\nКроків веб-пошуку не знайдено.")

# 3. Виконання коду: Будь-який код, запущений агентом, використовуючи інтерпретатор коду.
try:
    code_step = next(item for item in response.output if item.type == "code_interpreter_call")
    print("\n[Знайдено крок виконання коду]")
    print("  Вхід коду:")
    print(f"  ```python\n{code_step.input}\n  ```")
    print("  Вихід коду:")
    print(f"  {code_step.output}")
except StopIteration:
    print("\nКроків виконання коду не знайдено.")
```

Цей фрагмент коду використовує OpenAI API для виконання завдання «Deep Research». Він починається з ініціалізації клієнта OpenAI з вашим API-ключем, що критично важливо для аутентифікації. Потім він визначає роль ШІ-агента як професійного дослідника та встановлює дослідницький вопрос користувача про економічний вплив семаглутиду. Код конструює API-виклик до моделі o3-deep-research-2025-06-26, надаючи визначене системне повідомлення та користувацький запит як вхід. Він також запитує автоматичне резюме міркувань та включає можливості веб-пошуку. Після виконання API-виклику він витягує та надруковує остаточно сгенерований звіт.

Згодом він намагається отримати доступ та відобразити вбудовані цитати та метаданих з анотацій звіту, включаючи цитований текст, заголовок, URL та місцезнаходження у звіті. Нарешті, він інспектує та надруковує деталі про проміжні кроки, які підприймала модель, такі як кроки міркування, виклики веб-пошуку (включаючи виконаний запит) та будь-які кроки виконання коду, якщо використовувався інтерпретатор коду.

# З першого погляду

**Що:** Складні проблеми часто не можуть бути розв'язані однією дією та вимагають дальновидності для досягнення бажаного результату. Без структурованого підходу агентна система має труднощі з обробкою багатогранних запитів, що включають численні кроки та залежності. Це утруднює розбиття високорівневих цілей на керовану серію менших, виконуваних завдань. Як наслідок, система не може ефективно стратегічно планувати, що призводить до неповних або неправильних результатів при зіткненні зі складними цілями.

**Чому:** Паттерн Планування пропонує стандартизоване рішення, змушуючи агентну систему спочатку створити зв'язний план для досягнення мети. Він включає розпаду високорівневої мети на послідовність менших, виконуваних кроків або підцелей. Це дозволяє системі керувати складними робочими процесами, оркеструвати різні інструменти та обробляти залежності в логічному порядку. LLM особливо добре підходять для цього, оскільки вони можуть генерувати правдоподібні та ефективні плани на основі своїх обширних даних навчання. Цей структурований підхід перетворює простого реактивного агента на стратегічного виконавця, який може проактивно працювати над складною ціллю та навіть адаптувати свій план за необхідності.

**Емпіричне правило:** Використовуйте цей паттерн, коли запит користувача занадто складний для обробки однією дією або інструментом. Він ідеальний для автоматизації багатоетапних процесів, таких як генерування детального дослідницького звіту, адаптація нового працівника або виконання конкурентного аналізу. Застосовуйте паттерн Планування щоразу, коли завдання потребує послідовності взаємозалежних операцій для досягнення остаточного, синтезованого результату.

**Візуальне резюме**
![][image1]
Рис.4; Паттерн проектування Планування

# Ключові висновки

- Планування дозволяє агентам розбивати складні цілі на виконавані, послідовні кроки.
- Воно необхідне для обробки багатоетапних завдань, автоматизації робочих процесів та навігації в складних середовищах.
- LLM можуть виконувати планування, генеруючи покрокові підходи на основі описів завдань.
- Явне промптування або проектування завдань, що потребують кроків планування, заохочує цю поведінку у агентних фреймворках.
- Google Deep Research — це агент, що аналізує від нашого імені джерела, отримані за допомогою Google Search як інструменту. Він міркує, планує та виконує.

# Висновок

На висновок, паттерн Планування є основоположним компонентом, який піднімає агентні системи від простих реактивних респондентів до стратегічних, цілеспрямованих виконавців. Сучасні великі мовні моделі забезпечують основну здатність для цього, автономно розпадаючи високорівневі цілі в зв'язні, виконавані кроки. Цей паттерн масштабується від прямолінійного, послідовного виконання завдань, як демонстровано агентом CrewAI, що створює та слідує плану письма, до більш складних та динамічних систем. Агент Google DeepResearch ілюструє цей продвинуте застосування, створюючи ітеративні дослідницькі плани, які адаптуються та розвиваються на основі безперервного збору інформації. Зрештою, планування надає важливий міст між людським наміром та автоматизованим виконанням для складних проблем. Структуруючи підхід до розв'язання проблем, цей паттерн дозволяє агентам керувати складними робочими процесами та надавати всебічні, синтезовані результати.

# Посилання

1. Google DeepResearch (Gemini Feature): [gemini.google.com](http://gemini.google.com)
2. OpenAI, Introducing deep research [https://openai.com/index/introducing-deep-research/](https://openai.com/index/introducing-deep-research/)
3. Perplexity, Introducing Perplexity Deep Research, [https://www.perplexity.ai/hub/blog/introducing-perplexity-deep-research](https://www.perplexity.ai/hub/blog/introducing-perplexity-deep-research)

[image1]: ../Assets/chapter-6-image1.jpg
[image2]: ../Assets/chapter-6-image2.jpg
[image3]: ../Assets/chapter-6-image3.jpg
[image4]: ../Assets/chapter-6-image4.jpg

---

## Навігація

**Назад:** [Розділ 5. Використання інструментів](Розділ%205.%20Використання%20інструментів.md)<br>
**Вперед:** [Розділ 7. Багатоагентне співробітництво](Розділ%207.%20Багатоагентне%20співробітництво.md)
